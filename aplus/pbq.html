<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>CompTIA A+ PBQs</title>
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      min-height: 100vh;
      background: black;
      color: #00FF00;
      font-family: monospace;
      font-size: 1.1rem;
      padding: 1rem;
    }

    .pbq-container {
      max-width: 800px;
      margin: auto;
    }

    .instructions {
      text-align: center;
      font-size: 1.5rem;
      margin-bottom: 1rem;
    }

    .tools-container {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      padding: 0.5rem;
      border: 2px solid #00FF00;
      border-radius: 5px;
      margin-bottom: 1rem;
      background: #111;
    }

    .order-container {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      padding: 0.5rem;
      border: 2px solid #00FF00;
      border-radius: 5px;
      background: #111;
    }

    .tool, .step {
      background: #0b0b0b;
      border: 2px solid #00FF00;
      padding: 0.5rem 1rem;
      border-radius: 5px;
      cursor: grab;
      user-select: none;
      flex: 1 1 auto;
      transition: background-color 0.2s, color 0.2s;
    }

    .tool:hover, .step:hover {
      background-color: #00FF00;
      color: black;
    }

    .description-box {
      border: 2px solid #00FF00;
      padding: 0.5rem;
      background: #111;
      border-radius: 5px;
      min-height: 3rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .step-box {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .step-number {
      font-weight: bold;
    }

    .result-icon {
      font-size: 1.2rem;
      margin-left: 10px;
    }

    .correct .result-icon { color: lime; }
    .incorrect .result-icon { color: red; }

    .buttons {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 1rem;
      margin-top: 1rem;
    }

    button {
      background: transparent;
      color: #00FF00;
      border: 2px solid #00FF00;
      padding: 0.5rem 1rem;
      font-family: monospace;
      border-radius: 5px;
      cursor: pointer;
    }

    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .feedback {
      text-align: center;
      margin-top: 1rem;
    }

    .hidden { display: none; }
  </style>
</head>
<body>

<!-- Fixed top-left back button -->
<button id="topBack" style="
  position: fixed;
  top: 1rem;
  left: 1rem;
  background: transparent;
  color: #00FF00;
  border: 2px solid #00FF00;
  padding: 0.3rem 0.6rem;
  font-family: monospace;
  border-radius: 5px;
  cursor: pointer;
  z-index: 9999;
">
  ← Back
</button>

<div class="pbq-container">

  <!-- PBQ 1 -->
  <div id="pbq1">
    <div class="instructions">PBQ 1: Match each tool to its correct description</div>
    <div id="tools1" class="tools-container"></div>
    <div id="descriptions1"></div>
  </div>

  <!-- PBQ 2 -->
  <div id="pbq2" class="hidden">
    <div class="instructions">PBQ 2: Drag the malware removal steps into the correct order</div>
    <div id="stepsPool" class="tools-container"></div>
    <div id="stepsTarget" class="order-container"></div>
  </div>

  <!-- PBQ 3 -->
  <div id="pbq3" class="hidden">
    <div class="instructions">PBQ 3: Drag the troubleshooting steps into the correct order</div>
    <div id="theoryStepsPool" class="tools-container"></div>
    <div id="theoryStepsTarget" class="order-container"></div>
  </div>

  <div class="buttons">
    <button id="clear">Clear</button>
    <button id="submit" disabled>Submit</button>
    <button id="next" disabled>Next ➡</button>
  </div>

  <div class="feedback" id="feedback"></div>

</div>

<script>
  const toolsData = [
    { name: "Crimper", id: "crimper", description: "Used to attach connectors to the end of cables by pressing metal pins into the conductors." },
    { name: "Cable Stripper", id: "cable_stripper", description: "Removes insulation from wires to expose conductors for connections." },
    { name: "Multimeter", id: "multimeter", description: "Measures electrical properties like voltage, current, and resistance." },
    { name: "Punch Down Tool", id: "punch_down_tool", description: "Inserts wires into insulation-displacement connectors on patch panels or outlets." },
    { name: "Loopback Plug", id: "loopback_plug", description: "Simulates network signals to test ports or network connectivity." }
  ];

  const malwareSteps = [
    "Identify and research malware symptoms",
    "Quarantine the infected system",
    "Disable system restore (in Windows)",
    "Remediate the system",
    "Schedule scans and run updates",
    "Enable system restore and create a restore point",
    "Educate the end user"
  ];

  const theorySteps = [
    "Identify the problem",
    "Establish a theory of probable cause",
    "Test the theory to determine cause",
    "Establish a plan of action to resolve the problem",
    "Implement the solution or escalate as necessary",
    "Verify full system functionality and implement preventive measures",
    "Document findings, actions, and outcomes"
  ];

  const toolsContainer = document.getElementById('tools1');
  const descriptionsContainer = document.getElementById('descriptions1');
  const stepsPool = document.getElementById('stepsPool');
  const stepsTarget = document.getElementById('stepsTarget');
  const theoryStepsPool = document.getElementById('theoryStepsPool');
  const theoryStepsTarget = document.getElementById('theoryStepsTarget');
  const feedback = document.getElementById('feedback');

  const submitBtn = document.getElementById('submit');
  const clearBtn = document.getElementById('clear');
  const nextBtn = document.getElementById('next');
  const topBackBtn = document.getElementById('topBack');

  let currentPBQ = 1;

  function shuffle(arr) {
    return [...arr].sort(() => Math.random() - 0.5);
  }

  function renderPBQ1() {
    toolsContainer.innerHTML = '';
    descriptionsContainer.innerHTML = '';
    shuffle(toolsData).forEach(tool => {
      const t = document.createElement('div');
      t.className = 'tool';
      t.draggable = true;
      t.dataset.id = tool.id;
      t.textContent = tool.name;
      toolsContainer.appendChild(t);
    });

    shuffle(toolsData).forEach(tool => {
      const box = document.createElement('div');
      box.className = 'description-box';
      box.dataset.answer = tool.id;
      box.innerHTML = `<span>${tool.description}</span>`;
      descriptionsContainer.appendChild(box);
    });
  }

  function renderPBQ2() {
    stepsPool.innerHTML = '';
    stepsTarget.innerHTML = '';

    shuffle(malwareSteps).forEach(step => {
      const div = document.createElement('div');
      div.className = 'step';
      div.draggable = true;
      div.textContent = step;
      div.dataset.step = step;
      stepsPool.appendChild(div);
    });

    malwareSteps.forEach((_, i) => {
      const target = document.createElement('div');
      target.className = 'description-box';
      target.dataset.index = i;

      const number = document.createElement('div');
      number.className = 'step-number';
      number.textContent = `${i + 1}.`;

      const holder = document.createElement('div');
      holder.className = 'step-box';
      holder.appendChild(number);

      target.appendChild(holder);
      stepsTarget.appendChild(target);
    });
  }

  function renderPBQ3() {
    theoryStepsPool.innerHTML = '';
    theoryStepsTarget.innerHTML = '';

    shuffle(theorySteps).forEach(step => {
      const div = document.createElement('div');
      div.className = 'step';
      div.draggable = true;
      div.textContent = step;
      div.dataset.step = step;
      theoryStepsPool.appendChild(div);
    });

    theorySteps.forEach((_, i) => {
      const target = document.createElement('div');
      target.className = 'description-box';
      target.dataset.index = i;

      const number = document.createElement('div');
      number.className = 'step-number';
      number.textContent = `${i + 1}.`;

      const holder = document.createElement('div');
      holder.className = 'step-box';
      holder.appendChild(number);

      target.appendChild(holder);
      theoryStepsTarget.appendChild(target);
    });
  }

  function setupDragDrop() {
    document.querySelectorAll('[draggable="true"]').forEach(el => {
      el.addEventListener('dragstart', e => {
        e.dataTransfer.setData('text/plain', e.target.dataset.id || e.target.dataset.step);
        e.dataTransfer.setData('type', e.target.classList.contains('tool') ? 'tool' : 'step');
        e.target.classList.add('dragging');
      });
      el.addEventListener('dragend', e => {
        e.target.classList.remove('dragging');
      });
    });

    document.querySelectorAll('.description-box, .tools-container, .order-container').forEach(target => {
      target.addEventListener('dragover', e => {
        e.preventDefault();
      });

      target.addEventListener('drop', e => {
        e.preventDefault();
        const type = e.dataTransfer.getData('type');
        const data = e.dataTransfer.getData('text/plain');
        let dragging = null;
        if (type === 'tool') {
          dragging = document.querySelector(`.tool[data-id="${data}"]`);
        } else if (type === 'step') {
          dragging = document.querySelector(`.step[data-step="${data}"]`);
        }
        if (!dragging) return;

        // Clone the dragged element to preserve the original in the pool
        const clone = dragging.cloneNode(true);
        clone.draggable = true;
        clone.addEventListener('dragstart', e => {
          e.dataTransfer.setData('text/plain', clone.dataset.id || clone.dataset.step);
          e.dataTransfer.setData('type', clone.classList.contains('tool') ? 'tool' : 'step');
          clone.classList.add('dragging');
        });
        clone.addEventListener('dragend', e => {
          clone.classList.remove('dragging');
        });

        // PBQ 1: Tools to descriptions
        if (type === 'tool' && currentPBQ === 1 && target.classList.contains('description-box')) {
          if (target.querySelector('.tool')) {
            feedback.textContent = 'This description already has a tool. Remove it first.';
            return;
          }
          target.querySelector('.tool')?.remove();
          target.appendChild(clone);
        }

        // PBQ 2: Malware steps to order
        if (type === 'step' && currentPBQ === 2 && target.classList.contains('description-box')) {
          if (target.querySelector('.step')) {
            feedback.textContent = 'This step slot is already filled. Remove it first.';
            return;
          }
          target.querySelector('.step')?.remove();
          target.querySelector('.step-box').appendChild(clone);
        }

        // PBQ 3: Troubleshooting steps to order
        if (type === 'step' && currentPBQ === 3 && target.classList.contains('description-box')) {
          if (target.querySelector('.step')) {
            feedback.textContent = 'This step slot is already filled. Remove it first.';
            return;
          }
          target.querySelector('.step')?.remove();
          target.querySelector('.step-box').appendChild(clone);
        }

        // Return to pool
        if (type === 'tool' && currentPBQ === 1 && target.classList.contains('tools-container')) {
          toolsContainer.appendChild(clone);
        }
        if (type === 'step' && currentPBQ === 2 && target.classList.contains('tools-container')) {
          stepsPool.appendChild(clone);
        }
        if (type === 'step' && currentPBQ === 3 && target.classList.contains('tools-container')) {
          theoryStepsPool.appendChild(clone);
        }

        enableSubmitIfReady();
      });
    });
  }

  function enableSubmitIfReady() {
    if (currentPBQ === 1) {
      const allFilled = [...document.querySelectorAll('#descriptions1 .description-box')]
        .every(box => box.querySelector('.tool'));
      submitBtn.disabled = !allFilled;
    } else if (currentPBQ === 2) {
      const allFilled = [...document.querySelectorAll('#stepsTarget .description-box')]
        .every(box => box.querySelector('.step'));
      submitBtn.disabled = !allFilled;
    } else if (currentPBQ === 3) {
      const allFilled = [...document.querySelectorAll('#theoryStepsTarget .description-box')]
        .every(box => box.querySelector('.step'));
      submitBtn.disabled = !allFilled;
    }
  }

  function clearIcons() {
    document.querySelectorAll('.description-box').forEach(box => {
      box.classList.remove('correct', 'incorrect');
      box.querySelector('.result-icon')?.remove();
    });
  }

  function checkPBQ1() {
    clearIcons();
    let correct = 0;
    document.querySelectorAll('#descriptions1 .description-box').forEach(box => {
      const tool = box.querySelector('.tool');
      const icon = document.createElement('span');
      icon.className = 'result-icon';
      if (tool && tool.dataset.id === box.dataset.answer) {
        icon.textContent = '✔';
        box.classList.add('correct');
        correct++;
      } else {
        icon.textContent = '✖';
        box.classList.add('incorrect');
      }
      box.appendChild(icon);
    });
    feedback.textContent = correct === toolsData.length
      ? '✅ All correct!'
      : '❌ Clear to try again or click Next.';
    nextBtn.disabled = false;
  }

  function checkPBQ2() {
    clearIcons();
    let correct = 0;
    document.querySelectorAll('#stepsTarget .description-box').forEach((box, idx) => {
      const step = box.querySelector('.step');
      const icon = document.createElement('span');
      icon.className = 'result-icon';
      if (step && step.dataset.step === malwareSteps[idx]) {
        icon.textContent = '✔';
        box.classList.add('correct');
        correct++;
      } else {
        icon.textContent = '✖';
        box.classList.add('incorrect');
      }
      box.appendChild(icon);
    });
    feedback.textContent = correct === malwareSteps.length
      ? '✅ Steps in perfect order!'
      : '❌ Clear to try again or click Next.';
    nextBtn.disabled = false;
  }

  function checkPBQ3() {
    clearIcons();
    let correct = 0;
    document.querySelectorAll('#theoryStepsTarget .description-box').forEach((box, idx) => {
      const step = box.querySelector('.step');
      const icon = document.createElement('span');
      icon.className = 'result-icon';
      if (step && step.dataset.step === theorySteps[idx]) {
        icon.textContent = '✔';
        box.classList.add('correct');
        correct++;
      } else {
        icon.textContent = '✖';
        box.classList.add('incorrect');
      }
      box.appendChild(icon);
    });
    feedback.textContent = correct === theorySteps.length
      ? '✅ Steps in perfect order!'
      : '❌ Clear to try again or click Next.';
    nextBtn.disabled = false;
  }

  submitBtn.addEventListener('click', () => {
    if (currentPBQ === 1) checkPBQ1();
    else if (currentPBQ === 2) checkPBQ2();
    else if (currentPBQ === 3) checkPBQ3();
  });

  clearBtn.addEventListener('click', () => {
    if (currentPBQ === 1) renderPBQ1();
    else if (currentPBQ === 2) renderPBQ2();
    else if (currentPBQ === 3) renderPBQ3();
    feedback.textContent = '';
    submitBtn.disabled = true;
    nextBtn.disabled = true;
    setupDragDrop();
  });

  nextBtn.addEventListener('click', () => {
    if (currentPBQ === 1) {
      document.getElementById('pbq1').classList.add('hidden');
      document.getElementById('pbq2').classList.remove('hidden');
      currentPBQ = 2;
      renderPBQ2();
      setupDragDrop();
      feedback.textContent = '';
      submitBtn.disabled = true;
      nextBtn.disabled = true;
    } else if (currentPBQ === 2) {
      document.getElementById('pbq2').classList.add('hidden');
      document.getElementById('pbq3').classList.remove('hidden');
      currentPBQ = 3;
      renderPBQ3();
      setupDragDrop();
      feedback.textContent = '';
      submitBtn.disabled = true;
      nextBtn.disabled = true;
    }
  });

  topBackBtn.addEventListener('click', () => {
    window.location.href = 'aplus.html';
  });

  // Initialize
  renderPBQ1();
  setupDragDrop();
</script>

</body>
</html>
