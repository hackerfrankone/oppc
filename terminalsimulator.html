<!DOCTYPE html>
<html lang="en">
<head>  
  <meta charset="UTF-8" />
  <meta http-equiv="Content-Security-Policy" content="
    default-src 'self' https://hackerfrankone.github.io; 
    script-src 'self' 'unsafe-inline'; 
    style-src 'self' 'unsafe-inline'; 
    img-src 'self' https://www.paypalobjects.com; 
    frame-src 'self' https://hackerfrankone.github.io;
    object-src 'self' https://hackerfrankone.github.io;
    connect-src 'self' https://student-live.oppcus2025.workers.dev;" />
  <meta http-equiv="Permissions-Policy" content="geolocation=(), microphone=(), camera=()" />
  <title>Ubuntu Terminal Simulator</title>
  <link rel="icon" type="image/png" href="images/oppcus.png" />
  <style>
    body {
      background-color: #000;
      color: #00FF00;
      font-family: monospace;
      text-align: center;
      padding: 30px;
      margin: 0;
      position: relative;
    }
    #terminal {
      background: #000;
      padding: 40px 20px 20px 20px;
      margin-bottom: 10px;
      border: 2px solid #00FF00;
      border-radius: 5px;
      box-shadow: 0 0 10px #00FF00;
      height: 400px;
      overflow-y: auto;
      white-space: pre-wrap;
      text-align: left;
    }
    #inputArea {
      display: flex;
      gap: 10px;
      align-items: center;
      background: #000;
    }
    #commandInput {
      background: #000;
      color: #00FF00;
      border: 2px solid #00FF00;
      font-family: monospace;
      font-size: 1rem;
      padding: 8px;
      flex: 1;
      min-width: 200px;
      outline: none;
      caret-color: #00FF00;
      border-radius: 3px;
    }
    .submit-button {
      background-color: #000;
      border: 2px solid #00FF00;
      color: #00FF00;
      padding: 8px 15px;
      cursor: pointer;
      font-family: monospace;
      font-weight: bold;
      box-shadow: 0 0 8px #00FF00;
      transition: transform 0.2s, box-shadow 0.3s;
    }
    .submit-button:hover {
      transform: scale(1.05);
      box-shadow: 0 0 15px #00FF00;
      background-color: #00FF00;
      color: #000;
    }
    .circle-button {
      width: 100px;
      height: 100px;
      background-color: #000;
      border: 2px solid #00FF00;
      border-radius: 50%;
      color: #00FF00;
      font-weight: bold;
      font-size: 0.85rem;
      display: flex;
      align-items: center;
      justify-content: center;
      text-decoration: none;
      box-shadow: 0 0 12px #00FF00;
      transition: transform 0.2s, box-shadow 0.3s;
      cursor: pointer;
      user-select: none;
    }
    .circle-button:hover {
      transform: scale(1.1);
      box-shadow: 0 0 20px #00FF00;
    }
    #backButton {
      position: fixed;
      top: 10px;
      left: 10px;
      background-color: #000;
      border: 2px solid #00FF00;
      border-radius: 5px;
      color: #00FF00;
      padding: 10px;
      font-weight: bold;
      font-size: 0.85rem;
      box-shadow: 0 0 12px #00FF00;
      transition: transform 0.2s, box-shadow 0.3s;
      text-decoration: none;
      user-select: none;
    }
    #backButton:hover {
      transform: scale(1.05);
      box-shadow: 0 0 20px #00FF00;
    }
    #cliButtonContainer {
      position: fixed;
      top: 10px;
      right: 10px;
      z-index: 1001;
    }
    /* Popup overlay */
    #cliPopupOverlay {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0; top: 0;
      width: 100vw; height: 100vh;
      background: rgba(0,0,0,0.85);
      backdrop-filter: blur(4px);
      -webkit-backdrop-filter: blur(4px);
    }
    /* Popup content */
    #cliPopup {
      position: absolute;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      background: #000;
      border: 3px solid #00FF00;
      border-radius: 8px;
      padding: 20px;
      width: 300px;
      max-height: 80vh;
      overflow-y: auto;
      color: #00FF00;
      font-family: monospace;
      white-space: pre-wrap;
      user-select: text;
    }
    #cliPopup h2 {
      margin-top: 0;
      margin-bottom: 10px;
      font-size: 1.25rem;
      font-weight: bold;
      text-align: center;
      user-select: none;
    }
    #cliPopupClose {
      position: absolute;
      top: 8px;
      right: 12px;
      cursor: pointer;
      font-weight: bold;
      font-size: 1.3rem;
      user-select: none;
      color: #00FF00;
    }
    #cliCommandsList {
      margin-top: 10px;
      line-height: 1.4;
      font-size: 1rem;
    }
  </style>
</head>
<body>
  <a id="backButton" href="index.html" title="Go Back">← Back</a>

  <div id="terminal">student@ubuntu:/home/student$ </div>

  <div id="inputArea">
    <input type="text" id="commandInput" placeholder="Type command here..." autocomplete="off" autofocus />
    <button class="submit-button" onclick="submitCommand()">Submit</button>
  </div>

  <div id="cliButtonContainer">
    <div class="circle-button" id="cliButton" title="Show CLI Commands">CLI Commands</div>
  </div>

  <!-- CLI Commands Popup -->
  <div id="cliPopupOverlay">
    <div id="cliPopup">
      <div id="cliPopupClose" title="Close">×</div>
      <h2>Linux CLI Commands</h2>
      <pre id="cliCommandsList"></pre>
    </div>
  </div>

<script>
  // Your existing variables and functions are here...

  const terminalOutput = document.getElementById('terminal');
  const commandInput = document.getElementById('commandInput');
  let currentPath = "/home/student";
  let fileSystem = {
    "/": ["bin", "etc", "var", "usr", "lib", "tmp", "dev", "proc", "boot", "home", "root"],
    "/bin": [],
    "/etc": [{ name: "passwd", content: "student:x:1000:1000:Student User:/home/student:/bin/bash" }],
    "/var": [],
    "/usr": ["bin", "lib"],
    "/usr/bin": [],
    "/lib": [],
    "/tmp": [],
    "/dev": [],
    "/proc": [],
    "/boot": [],
    "/home": ["student"],
    "/root": [],
    "/home/student": [
      { name: "readme.txt", content: "Welcome to your Ubuntu terminal simulator!\nTry commands like ls, cat, whoami, or sudo apt install grep." },
      { name: "notes.txt", content: "This is a sample note file.\nFeel free to edit with touch or rm to remove." }
    ]
  };
  let installedPackages = { grep: true, find: true }; // Start with grep and find installed
  let history = [];
  let historyIndex = -1;

  function printToTerminal(text = "") {
    terminalOutput.innerHTML += text + "\n";
    terminalOutput.scrollTop = terminalOutput.scrollHeight;
  }

  function clearTerminal() {
    terminalOutput.innerHTML = `student@ubuntu:${currentPath}$ `;
  }

  function updatePrompt() {
    terminalOutput.innerHTML = terminalOutput.innerHTML.replace(/student@ubuntu:.*$/, "") + `student@ubuntu:${currentPath}$ `;
    terminalOutput.scrollTop = terminalOutput.scrollHeight;
  }

  function rebootTerminal() {
    fileSystem = {
      "/": ["bin", "etc", "var", "usr", "lib", "tmp", "dev", "proc", "boot", "home", "root"],
      "/bin": [],
      "/etc": [{ name: "passwd", content: "student:x:1000:1000:Student User:/home/student:/bin/bash" }],
      "/var": [],
      "/usr": ["bin", "lib"],
      "/usr/bin": [],
      "/lib": [],
      "/tmp": [],
      "/dev": [],
      "/proc": [],
      "/boot": [],
      "/home": ["student"],
      "/root": [],
      "/home/student": [
        { name: "readme.txt", content: "Welcome to your Ubuntu terminal simulator!\nTry commands like ls, cat, whoami, or sudo apt install grep." },
        { name: "notes.txt", content: "This is a sample note file.\nFeel free to edit with touch or rm to remove." }
      ]
    };
    installedPackages = { grep: true, find: true };
    currentPath = "/home/student";
    clearTerminal();
  }

  function getAbsolutePath(relativePath) {
    if (relativePath.startsWith("/")) {
      const parts = relativePath.split("/").filter(p => p);
      let path = "/";
      for (let part of parts) {
        path = getAbsolutePath(path + (path === "/" ? "" : "/") + part);
      }
      return path;
    }
    const parts = currentPath.split("/").filter(p => p);
    if (relativePath === "..") {
      parts.pop();
      return "/" + parts.join("/") || "/";
    }
    return currentPath + (currentPath === "/" ? "" : "/") + relativePath;
  }

  function getCompletions(input) {
    const [command, ...args] = input.trim().split(" ");
    const commands = ["ls", "pwd", "uname", "mkdir", "touch", "cd", "clear", "file", "grep", "find", "whoami", "cat", "rm", "mv", "cp"];
    let matches = [];

    if (!args.length) {
      matches = commands.filter(cmd => cmd.startsWith(command));
    } else {
      const dir = (fileSystem[currentPath] || []).map(item => item.name || item);
      matches = dir.filter(item => item.startsWith(args[args.length - 1]));
    }

    return matches;
  }

  function handleTabCompletion() {
    const input = commandInput.value;
    const matches = getCompletions(input);

    if (matches.length === 1) {
      const [command, ...args] = input.trim().split(" ");
      if (!args.length) {
        commandInput.value = matches[0];
      } else {
        const lastArg = args[args.length - 1];
        commandInput.value = input.replace(lastArg, matches[0]) + (input.endsWith(" ") ? " " : "");
      }
    } else if (matches.length > 1) {
      printToTerminal(matches.join(" "));
    }
  }

  function submitCommand() {
    const input = commandInput.value.trim();
    if (input === '') return;

    printToTerminal(`student@ubuntu:${currentPath}$ ${input}`);
    history.push(input);
    historyIndex = history.length;
    const [firstWord, ...args] = input.split(" ");
    const command = firstWord.toLowerCase();

    if (command === "sudo" && args[0] === "apt" && args[1] === "install") {
      const packageName = args[2];
      if (packageName) {
        if (["grep", "find"].includes(packageName)) {
          if (!installedPackages[packageName]) {
            installedPackages[packageName] = true;
            printToTerminal("Reading package lists... Done");
            printToTerminal("Building dependency tree... Done");
            printToTerminal("The following NEW packages will be installed:");
            printToTerminal(`  ${packageName}`);
            printToTerminal("0 upgraded, 1 newly installed, 0 to remove and 0 not upgraded.");
            printToTerminal("Need to get 0 B of archives. After this operation, 0 B of additional disk space will be used.");
            printToTerminal(`Setting up ${packageName} (1.0-1) ...`);
            printToTerminal("Processing triggers for man-db (2.9.1-1) ...");
            printToTerminal(`Done! ${packageName} is now installed.`);
          } else {
            printToTerminal(`${packageName} is already the newest version (1.0-1).`);
            printToTerminal("0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.");
          }
        } else {
          printToTerminal(`E: Unable to locate package ${packageName}`);
        }
      } else {
        printToTerminal("apt: missing package name");
      }
      updatePrompt();
      commandInput.value = '';
      return;
    }

    switch (command) {
      case "ls":
        const dir = (fileSystem[currentPath] || []).map(item => item.name || item);
        printToTerminal(`total ${dir.length}`);
        printToTerminal(dir.length > 0 ? dir.join(" ") : "");
        break;
      case "pwd":
        printToTerminal(currentPath);
        break;
      case "uname":
        if (args[0] === "-r") {
          printToTerminal("5.15.0-73-generic");
        } else {
          printToTerminal("uname: invalid option -- '" + args[0] + "'");
          printToTerminal("Usage: uname [OPTION]... Try 'uname --help' for more information.");
        }
        break;
      case "mkdir":
        if (args.length > 0) {
          const dirName = args[0];
          if (!fileSystem[currentPath]) fileSystem[currentPath] = [];
          if (!fileSystem[currentPath].some(item => item.name === dirName || item === dirName)) {
            fileSystem[currentPath].push(dirName);
            const absPath = getAbsolutePath(dirName);
            fileSystem[absPath] = [];
            printToTerminal(`mkdir: created directory '${dirName}'`);
          } else {
            printToTerminal(`mkdir: cannot create directory '${dirName}': File exists`);
          }
        } else {
          printToTerminal("mkdir: missing operand");
          printToTerminal("Try 'mkdir --help' for more information.");
        }
        break;
      case "touch":
        if (args.length > 0) {
          const fileName = args[0];
          if (!fileSystem[currentPath]) fileSystem[currentPath] = [];
          if (!fileSystem[currentPath].some(item => item.name === fileName || item === fileName)) {
            fileSystem[currentPath].push({ name: fileName, content: "" });
            printToTerminal(`touch: created file '${fileName}'`);
          } else {
            printToTerminal(`touch: cannot create file '${fileName}': File exists`);
          }
        } else {
          printToTerminal("touch: missing operand");
          printToTerminal("Try 'touch --help' for more information.");
        }
        break;
      case "cd":
        if (args.length > 0) {
          const newPath = args[0];
          const absPath = getAbsolutePath(newPath);
          if (fileSystem[absPath] || newPath === "/") {
            currentPath = absPath;
          } else if (newPath === ".." && currentPath !== "/") {
            const parts = currentPath.split("/").filter(p => p);
            parts.pop();
            currentPath = "/" + parts.join("/") || "/";
          } else {
            printToTerminal(`cd: ${newPath}: No such file or directory`);
          }
          updatePrompt();
        } else {
          printToTerminal("cd: missing operand");
        }
        break;
      case "clear":
        clearTerminal();
        break;
      case "file":
        if (args.length > 0) {
          const target = args[0];
          const absPath = getAbsolutePath(target);
          const dirContent = fileSystem[currentPath] || [];
          const item = dirContent.find(item => item.name === target || item === target);
          if (item) {
            printToTerminal(`${target}: ${fileSystem[absPath] ? "directory" : "regular file, text"}`);
          } else {
            printToTerminal(`file: ${target}: No such file or directory`);
          }
        } else {
          printToTerminal("file: missing operand");
          printToTerminal("Try 'file --help' for more information.");
        }
        break;
      case "grep":
        if (installedPackages["grep"]) {
          if (args.length > 1) {
            const pattern = args[0];
            const fileName = args[1];
            const dirContent = fileSystem[currentPath] || [];
            const file = dirContent.find(item => item.name === fileName);
            if (file && file.content) {
              const lines = file.content.split("\n").filter(line => line.includes(pattern));
              if (lines.length > 0) {
                printToTerminal(lines.join("\n"));
              }
            } else {
              printToTerminal(`grep: ${fileName}: No such file or directory`);
            }
          } else {
            printToTerminal("grep: missing pattern or file");
            printToTerminal("Try 'grep --help' for more information.");
          }
        } else {
          printToTerminal("bash:
