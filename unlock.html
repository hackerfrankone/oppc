<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Unlock OPPCUS Token</title>
  <style>
    body { background:#000; color:#0F0; font-family:monospace; text-align:center; padding:50px; }
    button { background:#FFD140; color:#000; padding:10px 20px; font-weight:bold; border-radius:5px; cursor:pointer; }
    button:hover { background:#e6b800; }
  </style>
</head>
<body>
  <h1>üîì OPPCUS Token Generated</h1>
  <p>Your <strong>OPPCUS-token.html</strong> will be downloaded automatically.</p>

<script>
async function generateHash(salt) {
  const data = navigator.userAgent + navigator.language +
               screen.width + screen.height +
               Intl.DateTimeFormat().resolvedOptions().timeZone + salt;
  const encoder = new TextEncoder();
  const hashBuffer = await crypto.subtle.digest('SHA-256', encoder.encode(data));
  return Array.from(new Uint8Array(hashBuffer)).map(b=>b.toString(16).padStart(2,'0')).join('');
}

function randomSalt(length=8) {
  const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
  return Array.from(crypto.getRandomValues(new Uint8Array(length)))
              .map(x => chars[x % chars.length]).join('');
}

window.onload = async function() {
  // Generate salt + hash
  const salt = randomSalt();
  const hash = await generateHash(salt);

  // Save hash to localStorage for index.html verification
  localStorage.setItem('oppcusTokenHash', hash);
  localStorage.setItem('unlocked', 'paid');

  // Create token file content
  const tokenHTML = `
  <!DOCTYPE html>
  <html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>OPPCUS-token</title>
    <style>
      body { background:#000; color:#0F0; font-family:monospace; text-align:center; padding:50px; }
      .status { font-size:1.5rem; font-weight:bold; margin-top:20px; }
    </style>
  </head>
  <body>
    <h1>üîì OPPCUS-token</h1>
    <p>Validating your token...</p>
    <div id="status" class="status"></div>
    <script>
      const salt="${salt}";
      const validHash="${hash}";
      async function verifyMachine(){
        const data=navigator.userAgent+navigator.language+screen.width+screen.height+Intl.DateTimeFormat().resolvedOptions().timeZone+salt;
        const enc=new TextEncoder();
        const buf=await crypto.subtle.digest('SHA-256',enc.encode(data));
        const curHash=Array.from(new Uint8Array(buf)).map(b=>b.toString(16).padStart(2,'0')).join('');
        const statusEl=document.getElementById('status');
        if(curHash===validHash){
          localStorage.setItem('unlocked','paid');
          localStorage.setItem('oppcusTokenHash',validHash);
          statusEl.textContent="‚úÖ Access Granted";
          statusEl.style.color="#0F0";
          setTimeout(()=>window.location.href='https://hackerfrankone.github.io/oppc/index.html?unlocked=paid',1500);
        } else {
          statusEl.textContent="‚ùå Access Denied";
          statusEl.style.color="#F00";
        }
      }
      verifyMachine();
    <\/script>
  </body>
  </html>
  `;

  // Trigger download
  const blob = new Blob([tokenHTML], { type:'text/html' });
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'OPPCUS-token.html';
  a.click();

  // Redirect after short delay
  setTimeout(()=> {
    window.location.href = 'https://hackerfrankone.github.io/oppc/index.html?unlocked=paid';
  }, 1000);
};
</script>
</body>
</html>
